name: Retrieve collection information
description: Extract collection infromation from the galaxy.yml file

inputs:
  path:
    description: "Path to the galaxy.yml file"
    required: true

outputs:
  known_as:
    description: The name of the collection
    value: ${{ steps.namespace.outputs.value }}.${{ steps.name.outputs.value }}
  namespace:
    description: The collection namespace
    value: ${{ steps.namespace.outputs.value }}
  name:
    description: The collection name
    value: ${{ steps.name.outputs.value }}
  tree:
    description: The collection directory tree
    value: collections/ansible_collections/${{ steps.namespace.outputs.value }}/${{ steps.name.outputs.value }}

runs:
  using: composite
  steps:
    - name: Github action python requirements
      run: pip3 install yq
      shell: bash

    - name: Extract collection namespace
      id: namespace
      run: |
        echo "::set-output name=value::$(cat ${{ inputs.path }} | yq -r .namespace)"
      shell: bash

    - name: Extract collection name
      id: name
      run: |
        echo "::set-output name=value::$(cat ${{ inputs.path }} | yq -r .name)"
      shell: bash

    - name: Show the collection namespace
      run: echo ::notice title=Collection namespace::${{ steps.namespace.outputs.value }}
      shell: bash

    - name: Show the collection name
      run: echo ::notice title=Collection name::${{ steps.name.outputs.value }}
      shell: bash
